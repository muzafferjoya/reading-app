pipeline {
	environment {
	  registry = "muzaffarjoya/react-app"
	  registryCredential = 'dockerhub'
	  dockerImage = ''
	}
	agent any
	stages {
		stage('Checkout SCM'){
		 steps {
		   git 'https://github.com/muzafferjoya/reading-app.git'
		 }
		}
	    stage('Building Image'){
	     steps{
	      script{
	        dockerImage = docker.build registry + ":$BUILD_NUMBER"
	      }
	     }
	    }
	    stage('Deploy Image'){
	     steps{
	       script{
	         docker.withRegistry( '', registryCredential) {
	          dockerImage.push()
	         }
	       }
	     }
	    }
	    stage('Remove Unused Docker Image'){
	     steps{
	       sh "docker rmi $registry:$BUILD_NUMBER"
	     }
	    }
	}
}
